<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition template="/templates/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

	<ui:define name="body">
		<h:outputStylesheet library="css" name="style.css" />

		<div id="wrapper">

			<div id="header">
				<h:form prependId="false">
					<h2>
						<h:outputText value="Pull Request Bugzilla Overview Page" />
					</h2>
				</h:form>
			</div>

			<div id="content">
				<h:form prependId="false">
					<div id="table">
						<rich:dataTable value="#{dataTableScrollerBean.dataList}"
							var="dataVar" id="data" rows="20" rowClasses="odd-row, even-row"
							columnClasses="center-column,center-column,center-column,center-column,center-column,center-column,center-column,none,center-column"
							styleClass="stable">
							<!-- pull request id and current state -->
							<rich:column id="pullrequestcol"
								sortBy="#{dataVar.pullRequest.number}"
								sortOrder="#{dataTableScrollerBean.pullRequestOrder}">
								<f:facet name="header">
									<a4j:commandLink value="Pull Request"
										title="Sort By Pull Request" render="data, status"
										action="#{dataTableScrollerBean.sortByPullRequest()}" />
								</f:facet>
								<h:outputLink
									value="https://github.com/jbossas/jboss-eap/pull/#{dataVar.pullRequest.number}">
									<h:outputText value="#{dataVar.pullRequest.number}" />
								</h:outputLink>
							</rich:column>
							<rich:column id="statecol" sortBy="#{dataVar.pullRequest.state}"
								sortOrder="#{dataTableScrollerBean.stateOrder}">
								<f:facet name="header">
									<a4j:commandLink value="State"
										title="Sort By Pull Request State" render="data, status"
										action="#{dataTableScrollerBean.sortByState()}" />
								</f:facet>
								<h:outputText value="#{dataVar.pullRequest.state}" />
							</rich:column>

							<!-- lightning build result -->
							<rich:column id="buildresultcol" sortBy="#{dataVar.buildResult}"
								sortOrder="#{dataTableScrollerBean.buildResultOrder}">
								<f:facet name="header">
									<a4j:commandLink value="Lightning Build Result"
										title="Sort By Lightning Build Result" render="data, status"
										action="#{dataTableScrollerBean.sortByBuildResult()}" />
								</f:facet>
								<h:outputText value="#{dataVar.buildResult}" />
							</rich:column>

							<!-- upstream pull request id if provided -->
							<rich:column id="upstreamcol">
								<f:facet name="header">
									<h:outputText value="Upstream Pull Request" />
								</f:facet>
								<h:outputText value="N/A"
									rendered="#{dataVar.pullRequestUpStreams.size() == 0}" />
								<a4j:repeat value="#{dataVar.pullRequestUpStreams}"
									var="upstreampullrequest" id="upstreampullrequest"
									rendered="#{dataVar.pullRequestUpStreams.size() != 0}"
									rowKeyVar="i">
									<h:outputText value="&lt;br /&gt;&lt;br /&gt;"
										rendered="#{i>0}" escape="false" />
									<h:outputLink
										value="https://github.com/wildfly/wildfly/pull/#{upstreampullrequest.number}">
										<h:outputText value="#{upstreampullrequest.number}" />
									</h:outputLink>

								</a4j:repeat>
							</rich:column>

							<!-- bugzilla data information -->
							<ui:param name="bugs"
								value="#{dataVar.bugs.size() != 0 ? dataVar.bugs : null}" />
							<rich:column id="bugscol">
								<f:facet name="header">
									<h:outputText value="Bugzilla Bug" />
								</f:facet>
								<h:outputText value="N/A" rendered="#{bugs == null}" />
								<a4j:repeat value="#{bugs}" var="bugid" id="bugid"
									rendered="#{bugs != null}" rowKeyVar="i">
									<h:outputText value="&lt;br /&gt;&lt;br /&gt;"
										rendered="#{i>0}" escape="false" />
									<h:outputLink
										value="https://bugzilla.redhat.com/show_bug.cgi?id=#{bugid.id}">
										<h:outputText value="bz#{bugid.id}" />
									</h:outputLink>
								</a4j:repeat>
							</rich:column>
							<!--
							<rich:column>
								<f:facet name="header">
									<h:outputText value="Bugzilla Bug Summary" />
								</f:facet>
								<h:outputText
									value="#{dataVar.bug != null ? dataVar.bug.summary  : 'N/A'}"
									align="center" />
							</rich:column>
							-->
							<rich:column id="statuscol">
								<f:facet name="header">
									<h:outputText value="Bugzilla Bug Status" />
								</f:facet>
								<h:outputText value="N/A" rendered="#{bugs == null}" />
								<a4j:repeat value="#{bugs}" var="bugstatus" id="bugstatus"
									rendered="#{bugs != null}" rowKeyVar="i">
									<h:outputText value="&lt;br /&gt;&lt;br /&gt;"
										rendered="#{i>0}" escape="false" />
									<h:outputText value="#{bugstatus.status}" />
								</a4j:repeat>
							</rich:column>
							<rich:column id="flagscol">
								<f:facet name="header">
									<h:outputText value="Bugzilla Bug Flags" />
								</f:facet>
								<h:outputText value="N/A" rendered="#{bugs == null}" />
								<a4j:repeat value="#{bugs}" var="bugflags" id="bugflags"
									rendered="#{bugs != null}" rowKeyVar="i">
									<h:outputText value="&lt;br /&gt;" rendered="#{i>0}"
										escape="false" />
									<rich:list value="#{bugflags.flags}" var="flag" id="flag"
										rendered="#{bugflags.flags.size() != 0}"
										style="text-align: left">
										<h:outputText value="#{flag.name} = #{flag.status}" />
									</rich:list>
								</a4j:repeat>
							</rich:column>
							<rich:column id="summarycol">
								<f:facet name="header">
									<h:outputText value="Summary" />
								</f:facet>
								<rich:list value="#{dataVar.overallState}" var="overallstate"
									id="orverallstate">
									<h:outputText value="#{overallstate}" />
								</rich:list>
							</rich:column>
							<rich:column id="mergeablecol" sortBy="#{dataVar.mergeable}"
								sortOrder="#{dataTableScrollerBean.mergeableOrder}">
								<f:facet name="header">
									<a4j:commandLink value="Mergeable" title="Sort By Mergeable"
										render="data, status"
										action="#{dataTableScrollerBean.sortByMergeable()}" />
								</f:facet>
								<h:outputText value="#{dataVar.mergeable}" />
							</rich:column>
						</rich:dataTable>

						<rich:dataScroller for="data" maxPages="5">
							<f:facet name="first">
								<h:outputText value="First" />
							</f:facet>
							<f:facet name="last">
								<h:outputText value="Last" />
							</f:facet>
						</rich:dataScroller>
					</div>
					<div id="push-to-table">
						<a4j:push address="pushAddress">
							<a4j:ajax event="dataavailable" render="data" />
						</a4j:push>
					</div>
				</h:form>
			</div>
		</div>

		<rich:jQuery selector=".stable tr:odd" query="addClass('odd-row')" />
		<rich:jQuery selector=".stable tr:even" query="addClass('even-row')" />
		<rich:jQuery selector=".stable tr" event="mouseover"
			query="jQuery(this).addClass('active-row')" />
		<rich:jQuery selector=".stable tr" event="mouseout"
			query="jQuery(this).removeClass('active-row')" />
	</ui:define>
</ui:composition>